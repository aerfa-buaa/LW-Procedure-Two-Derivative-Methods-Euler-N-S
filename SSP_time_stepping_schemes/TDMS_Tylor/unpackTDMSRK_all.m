function [A,Ahat,v,vhat,d,b,L] =  unpackTDMSRK_all(x, chars, w)
L=1;

%% TDMS34
if chars==34
    b1 = x(1);   b2 = x(2);   v1 = x(3);      w1=w(1); w2=w(2);
    b3=1 - b1 - b2;    vv2 = 0;
    % å¸¸è§„æ¨¡åž‹:
    % b1     f(x,y) = a+b*x^c*y^d*exp(f)
    % ç³»æ•°(ç½®ä¿¡è¾¹ç•Œä¸? 95%):
    %        a =   -0.006483  (-0.03692, 0.02395)
    %        b =       11.59  (-2.774e+07, 2.774e+07)
    %        c =      -1.189  (-1.342, -1.036)
    %        d =      -1.902  (-2.147, -1.658)
    %        f =      -3.764  (-2.392e+06, 2.392e+06)


    vv1=(1/12).*w1.^(-2).*(w1+w2).^(-1).*(3.*w1+w2).^(-1).*(3+4.*w2+b2.* ...
        w2.^4+12.*v1.*w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1).*w2).*(w1+ ...
        w2).^3);

    v2= (3.*w1+(-1).*w2).^(-1).*w2.^(-3).*(1+w2+w1.*(1+b2.*w2.^3+v1.*(w1+ ...
        w2).^3+(-1/2).*w1.^(-1).*(w1+w2).*(3.*w1+w2).^(-1).*(3+4.*w2+b2.* ...
        w2.^4+12.*v1.*w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1).*w2).*(w1+ ...
        w2).^3)));

    vv3=(1/12).*w2.^(-1).*(w1+w2).^(-1).*(3+2.*w1.*(2+3.*w2+(-1).*(b1+b2) ...
        .*w2.^3)+w2.*(8+6.*w2+(-1).*(b1+b2).*w2.^3)+w1.^4.*(b1+(-1).*w1.^( ...
        -2).*(w1+w2).^(-1).*(3.*w1+w2).^(-1).*(3+4.*w2+b2.*w2.^4+12.*v1.* ...
        w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1).*w2).*(w1+w2).^3))+2.* ...
        w1.^3.*w2.*(b1+(-1/2).*w1.^(-2).*(w1+w2).^(-1).*(3.*w1+w2).^(-1).* ...
        (3+4.*w2+b2.*w2.^4+12.*v1.*w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1) ...
        .*w2).*(w1+w2).^3)));

    v3=(1/2).*w2.^(-2).*(3.*w1+w2).^(-1).*((-1)+(-1).*(b1+(-2).*v1).* ...
        w1.^4+(-2).*(w1+w2)+w2.^3.*(2+(b1+b2).*w2)+2.*w1.*w2.^2.*(3+2.*( ...
        b1+b2).*w2)+w1.^3.*((-4).*b1.*w2+6.*v1.*w2));


    d=[1  0 0;
        0 1 0;
        0 0 1;];
    b=[b1,  b2,  b3];
    A=[0  0 0;
        0  0 0;
        0  0 0;];
    Ahat =[0  0 0;
        0  0 0;
        0  0 0;];
    v=[w1*v1, w2*v2, v3] ;
    vhat=[w1*w1*vv1, w2*w2*vv2, vv3] ;
end
%% TDMS341
if chars==341
    % 0.0265839426174917	0.347059703965716	-0.429361803536009
    b1 = x(1);   b2 = x(2);  w1=w(1); w2=w(2);
    b3=1 - b1 - b2;
    v1 = 0; vv2 = 0;

    vv1 = (3 + 4*w2 + b2*w2^4 - b1*(3*w1 - w2)*(w1 + w2)^3)/...
        (12*w1^2*(w1 + w2)*(3*w1 + w2));
    v3 = (-2 - 3*w2 + w2^3 + 6*vv1*w1^2*(w1 + w2)*...
        (4*w1 + w2) + b1*w1^2*(w1 + w2)*(2*w1 + 3*w2))/w2^3;
    v2 = (-1 - w2 + b1*w1*(w1 + w2)^3 + 6*vv1*w1^2*(w1 + w2)*  (2*w1 + w2))/w2^4;
    vv3 = (-vv1)*w1^2 + v2*w2^2 + (1/2)*(1 - b1*(-w1 - w2)^2 -    b2*w2^2);

    d=[1  0 0;
        0 1 0;
        0 0 1;];
    b=[b1,  b2,  b3];
    A=[0  0 0;
        0  0 0;
        0  0 0;];
    Ahat =[0  0 0;
        0  0 0;
        0  0 0;];
    v=[w1*v1, w2*v2, v3] ;
    vhat=[w1*w1*vv1, w2*w2*vv2, vv3] ;
end

%% TDMS349
if chars==349
    w1=w(1); w2=w(2);

%     b1= -0.2827+0.08823*w1^2+ 6.246*exp(-1.227*w1 -1.354*w2) ;
%     b2=0.2045+0.3156*w1^(-1.508 )*w2^1.065-3.095 *exp( -2.123*w1);
    
        b1= -0.283+0.088*w1^2+ 6.246*exp(-1.227*w1 -1.354*w2) ;
    b2=0.205+0.3156*w1^(-1.508 )*w2^1.065-3.1 *exp( -2.123*w1);
    
    v1 =   22.23+8.837*w1^2 -14.05*exp(0.7255*w1-0.1072*w2)-9.275*sin(0.5058*w2);

% if(w1+w2<1.8)
%     b2=0.01;
% end

    b3=1 - b1 - b2;    vv2 = 0;
    vv1=(1/12).*w1.^(-2).*(w1+w2).^(-1).*(3.*w1+w2).^(-1).*(3+4.*w2+b2.* ...
        w2.^4+12.*v1.*w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1).*w2).*(w1+ ...
        w2).^3);

    v2= (3.*w1+(-1).*w2).^(-1).*w2.^(-3).*(1+w2+w1.*(1+b2.*w2.^3+v1.*(w1+ ...
        w2).^3+(-1/2).*w1.^(-1).*(w1+w2).*(3.*w1+w2).^(-1).*(3+4.*w2+b2.* ...
        w2.^4+12.*v1.*w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1).*w2).*(w1+ ...
        w2).^3)));

    vv3=(1/12).*w2.^(-1).*(w1+w2).^(-1).*(3+2.*w1.*(2+3.*w2+(-1).*(b1+b2) ...
        .*w2.^3)+w2.*(8+6.*w2+(-1).*(b1+b2).*w2.^3)+w1.^4.*(b1+(-1).*w1.^( ...
        -2).*(w1+w2).^(-1).*(3.*w1+w2).^(-1).*(3+4.*w2+b2.*w2.^4+12.*v1.* ...
        w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1).*w2).*(w1+w2).^3))+2.* ...
        w1.^3.*w2.*(b1+(-1/2).*w1.^(-2).*(w1+w2).^(-1).*(3.*w1+w2).^(-1).* ...
        (3+4.*w2+b2.*w2.^4+12.*v1.*w1.^2.*(w1+w2).^2+(-1).*b1.*(3.*w1+(-1) ...
        .*w2).*(w1+w2).^3)));

    v3=(1/2).*w2.^(-2).*(3.*w1+w2).^(-1).*((-1)+(-1).*(b1+(-2).*v1).* ...
        w1.^4+(-2).*(w1+w2)+w2.^3.*(2+(b1+b2).*w2)+2.*w1.*w2.^2.*(3+2.*( ...
        b1+b2).*w2)+w1.^3.*((-4).*b1.*w2+6.*v1.*w2));

    d=[1  0 0;
        0 1 0;
        0 0 1;];
    b=[b1,  b2,  b3];
    A=[0  0 0;
        0  0 0;
        0  0 0;];
    Ahat =[0  0 0;
        0  0 0;
        0  0 0;];
    v=[w1*v1, w2*v2, v3] ;
    vhat=[w1*w1*vv1, w2*w2*vv2, vv3] ;
end

%% TDMS340
if chars==340
    b1 = x(1);   b2 = x(2);   v1= x(3);  v2 = x(4);   v3 = x(5);
    vv1= x(6);  vv2 = x(7);   vv3 = x(8);  %v1=0;  vv2=0;
    w1=w(1); w2=w(2);
    L=[-w1-w2;
        -w2;
        0 ];
    b3=1 - b1 - b2;
    d=[1  0 0;
        0 1 0;
        0 0 1;];
    b=[b1,  b2,  b3];
    A=[0  0 0;
        0  0 0;
        0  0 0;];
    Ahat =[0  0 0;
        0  0 0;
        0  0 0;];
    v=[w1*v1, w2*v2, v3] ;
    vhat=[w1*w1*vv1, w2*w2*vv2, vv3] ;
end
%% TDMS240
if chars==240
    b1 = x(1);  v1 = x(2);  v2 = x(3);   vv1 = x(4);  vv2 = x(5);    w1=w(1);
    b2=1-b1;
    L=[-w1;
        0 ];
    d=[1, 0
        0, 1];
    b=[b1,  b2];
    A=[0  0;
        0  0;];
    Ahat =[0  0;
        0  0;];
    v=[w1*v1, v2] ;
    vhat=[w1*w1*vv1, vv2] ;
end
%% TDMS241
if chars==241
    b1 = x(1);   w1=w(1);
    v1 = (1/2) *(b1+w1^(-4)*(1+2*w1));
    v2 = (1/2) *(2+(-1)*w1^(-3)+(-2)*w1^(-2)+b1*w1);
    vv1 = (1/12) *w1^(-4)*(3+4*w1+b1*w1^4);
    vv2 = (1/12) *w1^(-2)*(3+w1*(8+6*w1+(-1)*b1*w1^3));
    %     v2 = 1/2 *(-1 + b1); v1 = (3 + b1)/2;vv1= (7 + b1)/12; vv2 = ( 17 - b1)/12;
    b2=1-b1;
    L=[-w1;
        0 ];
    d=[1, 0
        0, 1];
    b=[b1,  b2];
    A=[0  0;
        0  0;];
    Ahat =[0  0;
        0  0;];
    v=[w1*v1, v2] ;
    vhat=[w1*w1*vv1, vv2] ;
end
%% TDMS230
if chars==230

    b1 = x(1);  v1 = x(2);  v2 = x(3);   vv1 = x(4);  vv2 = x(5);    w1=w(1);
    b2=1-b1;
    L=[-w1;
        0 ];
    d=[1, 0
        0, 1];
    b=[b1,  b2];
    A=[0  0;
        0  0;];
    Ahat =[0  0;
        0  0;];
    v=[w1*v1, v2] ;
    vhat=[w1*w1*vv1, vv2] ;
end

%% TDMS23
if chars==23
    b1 = x(1);      w1=w(1);
    b2=1-b1;
    vv1 = 0;
    v1 = 1/3* (b1 + 1/w1^3);
    v2 = 1 - 1/(3 *w1^2) + (2 *b1 *w1)/3;
    vv2 = ( 2 + 3* w1 - b1* w1^3)/(6* w1);
    d=[1, 0
        0, 1];
    b=[b1,  b2];
    A=[0  0;
        0  0;];
    Ahat =[0  0;
        0  0;];
    v=[w1*v1, v2] ;
    vhat=[w1*w1*vv1, vv2] ;
end
%% TDMS239
if chars==239
    b1 = x(1);      w1=w(1);
    %       f(x) = a*x^b
    %    a =      0.4091  (0.4066, 0.4116)
    %        b =      -1.861  (-1.892, -1.829)
    b1= 0.4091 *w1^(-1.861) ;
    b2=1-b1;
    vv1 = 0;
    v1 = 1/3* (b1 + 1/w1^3);
    v2 = 1 - 1/(3 *w1^2) + (2 *b1 *w1)/3;
    vv2 = ( 2 + 3* w1 - b1* w1^3)/(6* w1);
    d=[1, 0
        0, 1];
    b=[b1,  b2];
    A=[0  0;
        0  0;];
    Ahat =[0  0;
        0  0;];
    v=[w1*v1, v2] ;
    vhat=[w1*w1*vv1, vv2] ;
end
%% TDMS231
if chars==231

    b1 = x(1);   v2 = x(2);      w1=w(1);
    b2=1-b1;
    v1=b1+(1+(-1).*v2).*w1.^(-1);
    vv1=(1/6).*w1.^(-3).*((-1)+w1.^2.*(3+(-3).*v2+2.*b1.*w1));
    vv2=(1/6).*w1.^(-1).*(1+w1.*(3+w1.*(3+(-3).*v2+b1.*w1)));
    d=[1, 0
        0, 1];
    b=[b1,  b2];
    A=[0  0;
        0  0;];
    Ahat =[0  0;
        0  0;];
    v=[w1*v1, v2] ;
    vhat=[w1*w1*vv1, vv2] ;
end

end
% count1= (stage-1)*step;  %d
% count2= count1 + step;   %b
% count3= count2 + (2*step+stage-2)*(stage-1)/2; %A
% count4= count3 + (step+stage-1);    %v
% count5 = count4 +(2*step+stage-2)*(stage-1)/2;  %Ahat
% count6= count5 + (step+stage-1);     %vhat
% di=eye(step);
% d=[di;reshape(x(1: count1),stage-1,step)];
% b= reshape(x(count1+1:count2),1,step) ;
% A=zeros(step+stage-1, step+stage-1);
% count=count2;
% for i = step+1 : step+stage-1
% A(i,1:i-1)=x(count+1:count+i-1);
% count= count+i-1;
% end
% v=[ reshape(x(count3+1:count4),1,step+stage-1)];
% Ahat=zeros(step+stage-1, step+stage-1);
% count=count4;
% for i = step+1 : step+stage-1
% Ahat(i,1:i-1)=x(count+1:count+i-1);
% count= count+i-1;
% end
% vhat=[ reshape(x(count5+1:count6),1,step+stage-1)];
